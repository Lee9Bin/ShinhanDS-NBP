<section id="about">
    <div class="list-button">
        <button id="button-all">기본 순</button>
        <button id="button-1">북마크</button>
        <button id="button-2">주문 많은 순</button>
        <button id="button-3">리뷰 많은 순</button>
    </div>

    <div class="about">
        {{#stores}}
        <div class="about__card category-1 box">
            <div class="about-store">
                <!--                    <img class="about__icon" src="/img/dog1.png" alt="a">-->
                <a href="javascript:void(0);" class="bookmark">
                    <i class="fa-regular fa-bookmark"></i>
                </a>
            </div>
            <div class="about-store-comment">
                <h2 class="about__title _1">
                    {{name}}
                </h2>
                <p class="about__text">
                    {{description}}
                </p>
            </div>
        </div>

        {{/stores}}
    </div>

    <button class="more-btn">더보기</button>
</section>

<script>
    const aboutGrid = document.querySelector('.about');
    const btn = document.querySelector('.more-btn');
    let currentPage = 0; // 초기 페이지 번호
    btn.addEventListener('click', async () => {
        try {
            console.log(currentPage);
            currentPage++; // 클릭할 때마다 페이지 번호 증가
            // 서버에 데이터 요청
            console.log(currentPage);
            const response = await fetch(`/api/get-more-data?page=${currentPage}&pageSize=8`);
            const newData = await response.json();
            console.log(newData)

            // 새로운 게시물을 동적으로 생성
            newData.forEach(item => {
                const newPost = document.createElement('div');
                newPost.className = 'about__card category-1 box';

                newPost.innerHTML = `
                <div class="about-store">
                    <a href="javascript:void(0);" class="bookmark">
                        <i class="fa-regular fa-bookmark"></i>
                    </a>
                </div>
                <div class="about-store-comment">
                    <h2 class="about__title _1">${item.name}</h2>
                    <p class="about__text">${item.description}</p>
                </div>
            `;

                aboutGrid.appendChild(newPost);

            });
                // 새로운 요소를 추가한 후에 about의 높이를 조절
                adjustAboutHeight();
        } catch (error) {
            console.error('Error loading more data:', error);
        }
    });
    async function fetchRenderedHTMLFromServer() {
        try {
            const response = await fetch('/customer/'); // 실제 엔드포인트에 맞게 수정
            const html = await response.text();
            return html;
        } catch (error) {
            console.error('Error fetching rendered HTML:', error);
        }
    }
    function adjustAboutHeight() {
        // 모든 .about__card의 높이를 가져와서 최대 높이를 찾음
        const maxCardHeight = Math.max(
                ...Array.from(document.querySelectorAll('.about__card')).map(card => card.clientHeight)
        );

        // .about의 높이 설정
        aboutGrid.style.height = `${aboutGrid.clientHeight}px`;
        // 공백을 줄이기 위해 스크롤 여부 확인
        const hasOverflow = aboutGrid.scrollHeight > aboutGrid.clientHeight;

        // 스크롤이 필요한 경우에만 스크롤을 활성화
        aboutGrid.style.overflowY = hasOverflow ? 'auto' : 'hidden';
    }
</script>